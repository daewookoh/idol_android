# SignUpPagesScreen

> 2단계 회원가입 화면 (약관동의 → 회원가입 폼)

---

## 🎯 주요 기능

- 2단계 회원가입 프로세스
- 이메일 및 SNS 회원가입 지원
- 실시간 입력 검증 (이메일, 닉네임, 추천인 코드)
- 약관동의 처리
- 회원가입 후 자동 로그인
- 이메일 인증 다이얼로그 처리

---

## 📦 UseCases

* **ValidateUserUseCase**: 이메일/닉네임/추천인 코드 검증
* **SignUpUseCase**: 회원가입 처리
* **SignInUseCase**: 회원가입 후 자동 로그인

---

## 🌐 호출 API 및 사용 Field

### User API
* **POST /user/validate**
  * type, value, appId
  * 응답: success, gcode, message, domain

* **POST /user/signup**
  * email, password, nickname, domain, recommender_code, app_id
  * 응답: success, msg, message, gcode, mcode

* **POST /user/signin**
  * domain, email, password, push_key, gmail, device_id, app_id
  * 응답: success, message, data.userId, data.email, data.username, data.nickname, data.profileImage, data.token

---

## 🔄 화면 플로우

### 1️⃣ 진입
* Navigation: LoginScreen 또는 EmailLoginScreen에서 회원가입 필요 시 이동
* 파라미터:
  * `email`: SNS 로그인에서 전달된 이메일 (옵션)
  * `password`: SNS 로그인에서 전달된 access token (옵션)
  * `displayName`: SNS 로그인에서 전달된 표시 이름 (옵션)
  * `domain`: 로그인 도메인 (email, kakao, google, line, facebook)

### 2️⃣ Step 1: 약관동의 페이지

| 액션 | 설명 | 결과 |
|------|------|------|
| 전체 동의 체크 | 모든 약관 일괄 동의 | 하위 항목 모두 체크 |
| 개별 약관 체크 | 이용약관, 개인정보처리방침, 만 14세 이상 | 필수 약관 모두 체크 시 다음 버튼 활성화 |
| 상세보기 클릭 | 약관 상세 내용 확인 | WebView로 약관 표시 |
| 다음 버튼 클릭 | 약관 동의 완료 | 회원가입 폼으로 이동 |

### 3️⃣ Step 2: 회원가입 폼 페이지

| 필드 | 이메일 로그인 | SNS 로그인 | 검증 |
|------|--------------|-----------|------|
| 이메일 | 입력 (필수) | 숨김 (자동 입력됨) | 서버 검증 (1초 디바운스) |
| 비밀번호 | 입력 (필수) | 숨김 (자동 입력됨) | 정규식 검증 (포커스 아웃) |
| 비밀번호 확인 | 입력 (필수) | 숨김 (자동 입력됨) | 일치 여부 (포커스 아웃) |
| 닉네임 | 입력 (필수) | 입력 (필수) | 서버 검증 (1.5초 디바운스) |
| 추천인 코드 | 입력 (선택) | 입력 (선택) | 서버 검증 (1.5초 디바운스) |

### 4️⃣ 회원가입 처리 플로우
1. FCM 토큰 확인 및 획득
2. signUp API 호출
3. **msg 필드 있음**: 이메일 인증 다이얼로그 표시 → StartUpScreen
4. **msg 필드 없음**: 자동 signIn API 호출 → 메인 화면

### 5️⃣ 종료
* ✅ 회원가입 성공 (자동 로그인) → StartUpScreen → 메인 화면
* 📧 이메일 인증 필요 → 이메일 인증 다이얼로그 → StartUpScreen
* ❌ 취소 시 → 이전 화면
* ⚠️ 에러 발생 시 → 에러 메시지 표시 (필드별 또는 전체)

---

## 💾 데이터 저장

### DataStore (키-값 저장소)

**저장 데이터**
* `fcmToken` - FCM 푸시 토큰 (회원가입 전 획득)
* `accessToken` - 서버 인증 토큰 (회원가입 후 자동 로그인 시)
* `loginDomain` - 로그인 도메인
* `loginEmail` - 로그인 이메일
* `userId`, `username`, `nickname`, `profileImage` - 사용자 정보

### AuthInterceptor (메모리)
* `email`, `domain`, `token` - API 호출 시 인증 헤더에 사용

---

## 🎨 UI 구성

### Step 1: 약관동의 페이지
| 요소 | 스펙 |
|------|------|
| **상단바** | 타이틀 "약관 동의", 뒤로가기 버튼 |
| **전체 동의** | 굵게, 크기 `16sp` |
| **구분선** | 높이 `1dp`, 색상 `gray110` |
| **개별 약관** | 체크박스 + 텍스트 + 상세보기, 필수 항목 빨간색 |
| **다음 버튼** | 하단 고정, 전체 너비, 필수 약관 모두 체크 시 활성화 |

### Step 2: 회원가입 폼 페이지
| 요소 | 스펙 |
|------|------|
| **상단바** | 타이틀 "회원가입", 뒤로가기 버튼 |
| **입력 필드** | 라벨 + 입력창 + 검증 아이콘/에러 메시지 |
| **필드 높이** | `36dp` |
| **스크롤** | 키보드가 올라와도 모든 필드 접근 가능 |
| **회원가입 버튼** | 하단 고정, 전체 너비, 모든 검증 통과 시 활성화 |

---

## ⚠️ 에러 처리

### Step 1: 약관동의
| 상황 | 처리 방법 |
|------|----------|
| 필수 약관 미동의 | 다이얼로그로 안내 메시지 |

### Step 2: 회원가입 폼
| 상황 | 처리 방법 |
|------|----------|
| 이메일 미입력 | "필수 항목" 에러 |
| 이메일 형식 오류 | "유효하지 않은 이메일 형식" 에러 |
| 이메일 중복 | 서버 응답 메시지 |
| 비밀번호 형식 오류 | "비밀번호 요구사항 확인" 에러 |
| 비밀번호 불일치 | "비밀번호가 일치하지 않음" 에러 |
| 닉네임 중복 (gcode=1011) | 필드 에러 표시 |
| 닉네임 욕설 (gcode=88888) | 필드 에러 + isBadWordsNickName=true |
| 추천인 없음 (gcode=1012) | 필드 에러 + Toast |
| 가입 시도 과다 (gcode=1013) | 다이얼로그 표시 |
| 버전 에러 (gcode=9000) | 다이얼로그 표시 |

---

## 🔐 입력 검증

### 이메일
* 형식: 표준 이메일 형식 (Patterns.EMAIL_ADDRESS)
* 서버 검증: validate API (type=email)
* 디바운스: 1초

### 비밀번호
* 길이: 8자 이상
* 조합: 영문, 숫자, 특수문자 중 2개 이상
* 특수문자: `[]"/;:'<>,.~!@#$%^&*()_+?!-=/\{}`
* 검증 시점: 포커스 아웃

### 닉네임
* 길이: 2~10자
* 서버 검증: validate API (type=nickname)
* 욕설 필터링: gcode=88888
* 디바운스: 1.5초

### 추천인 코드 (선택)
* 서버 검증: validate API (type=referral_code)
* 디바운스: 1.5초

---

## 🔄 자동 로그인 처리

회원가입 성공 후 자동으로 로그인 처리:
1. signUp API 응답의 msg 필드 확인
2. **msg 있음**: 이메일 인증 필요, 다이얼로그 표시 후 StartUpScreen
3. **msg 없음**: signIn API 자동 호출
4. 로그인 성공 시 인증 정보 저장 후 메인 화면

---

## 📝 주의사항

* 🔄 **2단계 프로세스**: 약관동의 → 회원가입 폼 순서 고정
* 🔐 **SNS 로그인**: 이메일/비밀번호 필드 숨김, 닉네임만 입력
* 📧 **이메일 인증**: msg 필드가 있으면 이메일 인증 다이얼로그 표시
* 🔑 **FCM 토큰**: 회원가입 전 필수 획득 (실패 시 빈 문자열로 진행)
* ⚡ **실시간 검증**: 디바운스를 통해 API 호출 최소화
* 🎯 **자동 포커스**: 회원가입 폼 진입 시 첫 입력 필드에 자동 포커스
* 🚫 **욕설 필터**: gcode=88888 시 isBadWordsNickName=true, 회원가입 차단
* 💾 **State 유지**: SavedStateHandle 사용으로 프로세스 중단 후 복구 가능
* 🔁 **자동 로그인**: msg 없으면 회원가입 후 자동으로 signIn API 호출

---

**문서 버전**: 1.0.0
**최종 수정일**: 2025-11-03
**작성**: 화면 분석 및 정리
